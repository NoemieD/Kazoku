var Momories=Backbone.Model.extend({defaults:{illu:"N/A",narration:"N/A"}}),Todos=Backbone.Collection.extend({url:"api/todo.json",model:Todo}),ListItem=Backbone.View.extend({tagName:"article",className:"row",template:_.template($("#list-item-tmpl").html()),events:{"click .btn-edit":"edit","click .btn-danger":"suppr"},initialize:function(){this.render(),this.listenTo(this.model,"change",this.render)},edit:function(){this.trigger("edit",this.model)},suppr:function(){this.trigger("suppr",this)},render:function(){this.$el.html(this.template(this.model.toJSON()))}}),List=Backbone.View.extend({el:"#list",initialize:function(){this.listenTo(this.model,"reset",this.render),this.listenTo(this.model,"add",this.add)},add:function(t){var e=new ListItem({model:t});this.listen(e),this.$el.append(e.el)},edit:function(t){this.trigger("edit",t)},suppr:function(t){this.stopListening(t),t.remove(),this.model.remove(t.model),delete t},listen:function(t){this.listenTo(t,"edit",this.edit),this.listenTo(t,"suppr",this.suppr)},render:function(){this.model.each(function(t){this.add(t)},this)}}),Form=Backbone.View.extend({el:"form",events:{"click #add":"valid"},initialize:function(){this.title=this.$("#title"),this.desc=this.$("#texte")},valid:function(t){if(t.preventDefault(),this.current)this.current.set({title:this.title.val(),desc:this.desc.val()});else{var e={};""!=this.title.val()&&(e.title=this.title.val()),""!=this.desc.val()&&(e.desc=this.desc.val()),this.trigger("add",e)}this.reset()},edit:function(t){this.current=t,this.title.val(t.get("title")),this.desc.val(t.get("desc"))},suppr:function(){id===this.current.get("id")&&this.reset()},reset:function(){null==this.current,this.title.val(""),this.desc.val("")}}),App=Backbone.View.extend({initialize:function(){this.model=new Todos,this.list=new List({model:this.model}),this.listenTo(this.list,"edit",this.edit),this.form=new Form,this.listenTo(this.form,"add",this.add),this.listenTo(this.model,"remove",this.suppr),this.model.fetch({reset:!0})},add:function(t){this.model.create(t)},edit:function(t){this.form.edit(t)},suppr:function(t){this.form.suppr(t.id)}}),app=new App;