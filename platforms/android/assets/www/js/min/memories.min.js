var Memorie=Backbone.Model.extend({defaults:{narration:"N/A",musique:"Sugar Sugar",date:"N/A",sphere:"Amour",emotion:""}}),Memories=Backbone.Collection.extend({url:"api/memories.json",model:Memorie}),ListItem=Backbone.View.extend({tagName:"div",template:_.template($("#list-item-tmpl").html()),events:{"click .btn-edit":"edit","click .btn-remove":"suppr"},initialize:function(){this.render(),this.listenTo(this.model,"change",this.render)},edit:function(){this.trigger("edit",this.model)},suppr:function(){this.trigger("suppr",this)},render:function(){this.$el.html(this.template(this.model.toJSON()))}}),List=Backbone.View.extend({el:"#list-memories",initialize:function(){this.listenTo(this.model,"reset",this.render),this.listenTo(this.model,"add",this.add)},add:function(t){var i=new ListItem({model:t});this.listen(i),this.$el.append(i.el)},edit:function(t){this.trigger("edit",t)},suppr:function(t){this.stopListening(t),t.remove(),this.model.remove(t.model),delete t},listen:function(t){this.listenTo(t,"edit",this.edit),this.listenTo(t,"suppr",this.suppr)},render:function(){this.model.each(function(t){this.add(t)},this)}}),Form=Backbone.View.extend({el:"form",events:{"click #add":"valid"},initialize:function(){this.illustration=this.$("#illustration"),this.narration=this.$("#narration"),this.date=this.$("#date"),this.sphere=this.$("#sphere"),this.emotion=this.$("#emotion"),this.partage=this.$("#distance")},valid:function(t){if(t.preventDefault(),this.current)this.current.set({illustration:this.illustration.val(),narration:this.narration.val(),date:this.date.val(),sphere:this.sphere.val(),emotion:this.emotion.val(),partage:this.partage.val()});else{var i={};""!=this.illustration.val()&&(i.illustration=this.illustration.val()),""!=this.narration.val()&&(i.narration=this.narration.val()),""!=this.date.val()&&(i.date=this.date.val()),""!=this.sphere.val()&&(i.sphere=this.sphere.val()),""!=this.emotion.val()&&(i.emotion=this.emotion.val()),""!=this.partage.val()&&(i.partage=this.partage.val()),this.trigger("add",i)}this.reset()},edit:function(t){this.current=t,this.illustration.val(t.get("illustration")),this.narration.val(t.get("narration")),this.date.val(t.get("date")),this.sphere.val(t.get("sphere")),this.emotion.val(t.get("emotion")),this.partage.val(t.get("partage"))},suppr:function(t){t===this.current.get("id")&&this.reset()},reset:function(){null==this.current,this.illustration.val(""),this.narration.val(""),this.date.val(""),this.sphere.val(""),this.emotion.val(""),this.partage.val("")}}),AddMemories=Backbone.View.extend({initialize:function(){this.model=new Memories,this.list=new List({model:this.model}),this.listenTo(this.list,"edit",this.edit),this.form=new Form,this.listenTo(this.form,"add",this.add),this.listenTo(this.model,"remove",this.suppr),this.model.fetch({reset:!0})},add:function(t){this.model.create(t)},edit:function(t){this.form.edit(t)},suppr:function(t){this.form.suppr(t.id)}}),addMemories=new AddMemories;